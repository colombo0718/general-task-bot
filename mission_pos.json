{
  "version": 3,
  "locale": "zh-TW",

  "classify_tree": {
    "prompt_key": "identify_needs",
    "branch": [
      { "match": "generateQuote",     "task_id": "generate_quote" },
      { "match": "queryPoints",       "task_id": "query_points" },
      { "match": "queryCredentials",  "task_id": "query_credentials" },
      { "match": "addPoints",         "task_id": "add_points" },
      { "match": "null",              "task_id": "fallback_greeting" }
    ]
  },

  "tasks": {
    "generate_quote": {
      "description": "產出報價單 PDF 並回傳下載連結",
      "human_check": "false",

      "fields": {
        "name":           { "prompt_key": "identify_name",       "required": true,  "match_pool": "customerlist.txt" },
        "include_tax":    { "prompt_key": "include_tax",         "required": false },
        "start_month":    { "prompt_key": "get_start_month",     "required": false },
        "charge_months":  { "prompt_key": "get_charge_months",   "required": false }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/api/quote?name={name}&charge_months={charge_months}&price_includes_tax={include_tax}"
      }
    },

    "query_points": {
      "description": "查詢指定公司目前點數並回覆數值",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },
      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/points?name={name}"
      }
    },

    "query_credentials": {
      "description": "查詢指定公司的登入帳號與密碼並回覆",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/credentials?name={name}"
      }
    },

    "add_points": {
      "description": "加點數（需確認）",
      "human_check": "true",
      "fields": {
        "name":  { "prompt_key": "identify_name",  "required": true,  "match_pool": "customerlist.txt" },
        "delta": { "prompt_key": "get_delta_point",      "required": true }
      },
      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "delta"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/add_points?name={name}&delta={delta}"
      }
    },

    "fallback_greeting": {
      "description": "分類失敗時的友善提示",
      "human_check": "false",
      "fields": {},
      "action": { "method": "GET", "url_template": "https://cwsoft.leaflune.org/ping" }
    }
  }
}
