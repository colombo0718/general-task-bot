{
  "version": 3,
  "locale": "zh-TW",

  "classify_tree": {
    "prompt_key": "identify_needs",
    "branch": [
      { "match": "generateQuote",     "task_id": "generate_quote" },
      { "match": "queryPoints",       "task_id": "query_points" },
      { "match": "adjustPoints",      "task_id": "adjust_points" },
      { "match": "querySmsPoints",    "task_id": "query_sms_points" },
      { "match": "adjustSmsPoints",   "task_id": "adjust_sms_points" },
      { "match": "queryCredentials",  "task_id": "query_credentials" },
      { "match": "companyName",       "task_id": "company_name" },
      { "match": "RegionCustomers",   "task_id": "region_customers" },   
      { "match": "getIntransit",      "task_id": "get_intransit_feature" },
      { "match": "setIntransit",      "task_id": "set_intransit_feature" },
      { "match": "restoreTestDB",     "task_id": "restore_test_db" },
      { "match": "rebuildInventory",  "task_id": "rebuild_inventory" },
      { "match": "addDevice",         "task_id": "add_device" }, 
      { "match": "addBranch",         "task_id": "add_branch" },
      { "match": "exportOffShelf",    "task_id": "export_off_shelf" },
      { "match": "addCustomer",       "task_id": "add_customer" },
      { "match": "detachCustomer",    "task_id": "detach_customer" },
      { "match": "null",              "task_id": "fallback_greeting" }
    ]
  },

  "tasks": {
    "generate_quote": {
      "description": "產出報價單 PDF 並回傳下載連結",
      "human_check": "false",

      "fields": {
        "name":           { "prompt_key": "identify_name",       "required": true,  "match_pool": "customerlist.txt" },
        "include_tax":    { "prompt_key": "include_tax",         "required": false },
        "start_month":    { "prompt_key": "get_start_month",     "required": false },
        "charge_months":  { "prompt_key": "get_charge_months",   "required": false }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/api/quote?name={name}&charge_months={charge_months}&price_includes_tax={include_tax}"
      }
    },

    "query_points": {
      "description": "查詢指定公司目前點數並回覆數值",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },
      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/query_points?name={name}"
      }
    },

    
    "adjust_points": {
      "description": "加點數（需確認）",
      "human_check": "true",
      "fields": {
        "name":  { "prompt_key": "identify_name",  "required": true,  "match_pool": "customerlist.txt" },
        "delta": { "prompt_key": "get_delta_amount",      "required": true }
      },
      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "delta"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/adjust_points?name={name}&delta={delta}"
      }
    },

    "query_sms_points": {
      "description": "查詢指定公司目前簡訊點數並回覆數值",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },
      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/query_sms_points?name={name}"
      }
    },


    "adjust_sms_points": {
      "description": "依金額加簡訊點數（需確認）",
      "human_check": "true",

      "fields": {
        "name":   { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" },
        "amount": { "prompt_key": "get_delta_amount",    "required": true }
      },
      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "amount"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/adjust_sms_points?name={name}&amount={amount}"
      }
    },

    "query_credentials": {
      "description": "查詢指定公司的登入帳號與密碼並回覆",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/credentials?name={name}"
      }
    },


    "company_name": {
      "description": "查詢指定公司的公司名稱並回覆",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/company_name?name={name}"
      }
    },

    "region_customers": {
      "description": "查詢指定地區有哪些客戶（依市話區碼開頭碼查詢公司名稱）",
      "human_check": "false",

      "fields": {
        "region_code": { "prompt_key": "get_region", "required": true }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/region_customers?region_code={region_code}"
      }
    },

    "get_intransit_feature": {
      "description": "查詢指定公司『在途庫存』功能是否開啟",
      "human_check": "false",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },

      "action": {
        "method": "GET",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/intransit_feature?name={name}"
      }
    },

    "set_intransit_feature": {
      "description": "設定指定公司『在途庫存』功能（0=關，1=開）",
      "human_check": "true",

      "fields": {
        "name":  { "prompt_key": "identify_name",        "required": true,  "match_pool": "customerlist.txt" },
        "value": { "prompt_key": "get_boolean_switch",   "required": true }  
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "value"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/set_intransit_feature?name={name}&value={value}"
      }
    },

    "restore_test_db": {
      "description": "將指定公司的『測試資料庫』還原到指定時間點（高風險動作，需確認）",
      "human_check": "true",

      "fields": {
        "name":         { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" },
        "restore_time": { "prompt_key": "get_datetime",  "required": true, "reference": true } 
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "restore_time"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/restore_test_db?name={name}&restore_time={restore_time}"
      }
    },

    "rebuild_inventory": {
      "description": "執行指定公司『即時庫存重整』",
      "human_check": "true",
      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },
      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/rebuild_inventory?name={name}"
      }
    },

    "add_customer": {
      "description": "在 POSConfig 建立新客戶（DBName、地區、帳號、密碼；不建立實體客戶 DB）",
      "human_check": "true",

      "fields": {
        "db_name":     { "prompt_key": "get_db_name",     "required": true },
        "region_code": { "prompt_key": "get_region",      "required": true },
        "account":     { "prompt_key": "get_account",     "required": true },
        "password":    { "prompt_key": "get_password",    "required": true },
        "shop_name":   { "prompt_key": "get_shop_name",   "required": false}
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["db_name","region_code","account","password","shop_name"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/add_customer?db_name={db_name}&region_code={region_code}&account={account}&password={password}&shop_name={shop_name}"
      }
    },
    
    "detach_customer": {
      "description": "下架客戶（自動推斷區碼，需確認）",
      "human_check": "true",

      "fields": {
        "name": { "prompt_key": "identify_name", "required": true, "match_pool": "customerlist.txt" }
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/detach_customer?name={name}"
      }
    },

    "add_device": {
      "description": "新增行動裝置（最少需：公司名稱 + 員工姓名或員工編號其一）",
      "human_check": "true",

      "fields": {
        "name":          { "prompt_key": "identify_name",      "required": true,  "match_pool": "customerlist.txt" },
        "employee_id":   { "prompt_key": "get_employee_id",    "required": false }
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name","employee_id"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/add_device?name={name}&employee_id={employee_id}"
      }
    },

    "add_branch": {
      "description": "在指定公司資料庫新增一個分店（店名唯一檢查，支援預覽/確認）",
      "human_check": "true",

      "fields": {
        "name":      { "prompt_key": "identify_name",  "required": true,  "match_pool": "customerlist.txt" },
        "shop_name": { "prompt_key": "get_shop_name",  "required": true }
      },

      "action": {
        "method": "GET",
        "confirm_method": "POST",
        "confirm_body_keys": ["name", "shop_name"],
        "url_template": "https://cwsoft.leaflune.org/sqlgate/add_branch?name={name}&shop_name={shop_name}"
      }
    },

    "export_off_shelf": {
      "description": "匯出指定公司於起訖期間的下架資料（只讀操作，直接執行）",
      "human_check": "false",

      "fields": {
        "name":        { "prompt_key": "identify_name",  "required": true,  "match_pool": "customerlist.txt" },
        "start_date":  { "prompt_key": "get_start_date", "required": true,  "reference": true },
        "end_date":    { "prompt_key": "get_end_date",   "required": false, "reference": true },
        "branch_code": { "prompt_key": "get_branch_code","required": false }
      },

      "action": {
        "method": "POST",
        "url_template": "https://cwsoft.leaflune.org/sqlgate/export_off_shelf?name={name}&start_date={start_date}&end_date={end_date}&branch_code={branch_code}"
      }
    },

    "fallback_greeting": {
      "description": "分類失敗時的友善提示",
      "human_check": "false",
      "fields": {},
      "action": { "method": "GET", "url_template": "https://cwsoft.leaflune.org/ping" }
    }
  }
}
